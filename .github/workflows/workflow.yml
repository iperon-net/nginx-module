name: workflow.yml

on:
  push:
    branches:
      - main

jobs:
  "download":
    name: "download"
    runs-on: ubuntu-latest
    timeout-minutes: 10
    strategy:
      matrix:
        version: [ release-1.28.*, release-1.29.* ]
    steps:

      - name: Get latest release
        id: release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          LATEST=$(curl -s \
            -H "Authorization: token $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/nginx/nginx/releases/latest)

          echo "tag=$LATEST" >> $GITHUB_OUTPUT

      - name: Use release info
        run: |
          echo "New release detected: ${{ steps.release.outputs.tag }}"
          

#          TAG=$(echo "$LATEST" | jq 'first(.[] |  select(.tag_name|test("${{ matrix.version }}"))) | {tag: .tag_name, name: .name, published: .published_at, prerelease: .prerelease}')
#          echo "tag=$TAG" >> $GITHUB_OUTPUT


#      - name: Checkout nginx repository
#        uses: actions/checkout@v6
#        with:
#          repository: nginx/nginx
#          path: nginx
##          ref: "release-1.29.*"
#
#      - name: Checkout ngx_http_geoip2_module repository
#        uses: actions/checkout@v6
#        with:
#          repository: leev/ngx_http_geoip2_module
#          path: ngx_http_geoip2_module
#
#      - name: Checkout headers-more-nginx-module repository
#        uses: actions/checkout@v6
#        with:
#          repository: openresty/headers-more-nginx-module
#          path: headers_more_nginx_module
#
#      - name: "Run console log"
#        run: |
#          sudo add-apt-repository -y ppa:maxmind/ppa
#          sudo apt update
#          sudo apt install libmaxminddb0 libmaxminddb-dev mmdb-bin
#
#          cd nginx/
#          ls -ls
#          ./auto/configure --with-compat --add-dynamic-module=../ngx_http_geoip2_module --add-dynamic-module=../headers_more_nginx_module
#          make modules
#          cd objs/
#          ls -ls
